# Лабораторная 1

Методичка по лабораторным

### Настройка окружения

```bash
// Настройка RVM
$ gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
$ \curl -sSL https://get.rvm.io | bash -s stable

$ rvm install ruby // Установка руби

$ gem install bundler // установка сборщика пакетов
$ gem install rails // установка Ruby on Rails

$ rails new <название> // создание приложения
```

### Запуск сервера

Для запуска сервера необходимо зайти в папку с проектом с помощью команды `cd` и выполнить следующую команду:

```
$ rails server
```

По умолчанию сайт будет доступен по адресу `localhost:3000`

### Создание модели

Далее необходимо настроить модели и связи в базе данных. Для автоматического создания модели и миграции воспользуемся генераторами rails:

```
$ rails generate model Word
```

Данная команда сгенерирует 2 файла со следующим содержимым:

`app/models/word.rb:`
```ruby
class Word < ApplicationRecord
end
```

`db/migrate/20180315070951_create_words.rb`
```ruby
class CreateWords < ActiveRecord::Migration[5.1]
  def change
    create_table :words do |t|

      t.timestamps
    end
  end
end
```

Далее настроим поля для модели:

```ruby
class CreateWords < ActiveRecord::Migration[5.1]
  def change
    create_table :words do |t|

      t.string :ru, nil: false
      t.string :en, nil: false

      t.timestamps
    end
  end
end

```

После добавления и настройки полей для базы данных в миграции необходимо выполнить миграцию командой:
```bash
$ rails db:migrate
```

Таким образом мы создали файл модели, добавили файл миграции, настроили поля, которые будут в базе данных и выполнили миграцию

### Настройка модели

Для начала мы должны настроить модель, добавив все необходимые валидации. Добавим следующие строки в файл модели:
```ruby
  validates :ru, :en, presence: true, length: { minimum: 3, maximum: 30 }
  validates :en, uniqueness: true
```

Тут мы указали, что для поля `:ru` и `:en` должны быть обязательно заполнены перед сохранением, быть длиной от 3 до 30 символов а так же поле `:en` должно быть уникальным, то есть иметь уникальное значения на всей базе данных

### Настройка сидов

Для того чтобы можно было заполнить базу тестовыми данными можно применить механизм сидов. Это специальный файл, в котором можно прописать рельсовый код и выполнить его специальной командой.

Для того чтобы сгенерировать сиды добавим гем `Faker`. Для этого необходимо добавить в файл `Gemfile` следующую строку и выполнить установку гема командой `bundle install`:
```ruby
gem 'faker'
```

Теперь мы можем добавить в файл сидов следующий код и выполнить его командой `rails db:seed`

`db/seeds.rb`
```ruby
100.times do
  Word.create ru: Faker::Lorem.word.capitalize, en: Faker::Lorem.word.capitalize
end
```

Данными манипуляциями мы добавили гем для генерации тестовых данных а так же заполнили базу данных сотней тестовых слов.


### Настройка маршрутов и контроллера

Для начала необходимо создать контроллер, который будет отвечать на запросы пользователя. Сделать это можно посредством следующей команды:
```bash
$ rails generate controller Words
```

Результатом выполнения данной команды будет создание файла контроллера со следующим содержимым:
``
```ruby
class WordsController < ApplicationController
end
```

Данный файл контроллера будет отвечать на запросы пользователя по `RESTу`

Следующим шавгом будет джобавления заглушки метода `index` для обеспечения возможность показывать список слов (читаем что такое REST!!!)

Добавим в файл контроллера следующий метод:

`app/controllers/words.rb`
```ruby
def index
  @words = Word.all
end
```

`Внимание!` переменные, определенные в контексте данного метода, которые начинаются с символа `@` будут доступны во вьюхе. В связи с этим мы создаем переменную, которая будет доступны во вьюхе изаписываем в нее весь список слов из базы данных

После этого необходимо сделать саму вьюху. Создадим файл по указанному пути: `app/views/words/index.html.erb`.
В данном файле мы расположим код, который будет показывать пользователю список слов:

```html
<table border="1" width="100%">
  <thead>
    <tr>
      <th>EN</th>
      <th>RU</th>
    </tr>
  </thead>
  <tbody>
    <% @words.each do |word| %>
      <tr>
        <td><%= word.en %></td>
        <td><%= word.ru %></td>
      </tr>
    <% end %>
  </tbody>
</table>
```

На для того чтобы это зарабюотало необходимо выполнить последнее действие - добавить маршрутизацию. Сделать это можно следующим способом:
`config/routes.rb`
```ruby
resources :words
```

Данной командой мы показываем Rails что для контроллера мы создаем REST маршруты. Проверить это можно командой `rails routes`